version: 0.2

phases:
  install:
    runtime-versions:
      java: corretto8
      nodejs: 12

  build:
    commands:
    - PROJECT_DIR=$(pwd)
    - echo $PROJECT_DIR
    - ls -rtl
    - chmod -R 755 *
    - mkdir -p $PROJECT_DIR/src/main/resources/static
    - echo "Running angular build"
    - ls -rtl
    - cd good-people-angular && npm install && npm install @angular/cli && npm run ng build --prod=true --outputPath=$PROJECT_DIR/src/main/resources/static
    - ls -rtl
    - cd $PROJECT_DIR
    - ls -rtl
    - echo "Checking angular output location"
    - ls -rtl $PROJECT_DIR/src/main/resources/static
    - echo "Running gradle build"
    - ls -rtl
    - ./gradlew createDist
    - echo "Done gradle createDist"
    - ls -rtl

artifacts:
  files:
    - appspec.yml
    - scripts/*
    - service.war